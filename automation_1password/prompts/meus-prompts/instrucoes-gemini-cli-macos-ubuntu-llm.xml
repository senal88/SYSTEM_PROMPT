<?xml version="1.0" encoding="UTF-8"?>
<!--
  Instru√ß√µes Detalhadas: Gemini CLI - macOS Silicon e Ubuntu
  Documento estruturado para m√°xima efici√™ncia de interpreta√ß√£o por LLMs
  
  Baseado na documenta√ß√£o oficial do Gemini CLI:
  https://github.com/google-gemini/gemini-cli
  
  Data de Cria√ß√£o: 2025-11-03
  Vers√£o: 1.0.0
  Formato: XML estruturado para parsing otimizado por LLMs
-->

<instrucoes_gemini_cli>
    <metadados>
        <nome>Instru√ß√µes de Instala√ß√£o e Configura√ß√£o: Gemini CLI</nome>
        <versao>1.0.0</versao>
        <data_criacao>2025-11-03</data_criacao>
        <ferramenta>Gemini CLI</ferramenta>
        <fabricante>Google</fabricante>
        <repositorio>https://github.com/google-gemini/gemini-cli</repositorio>
        <documentacao_oficial>https://google-gemini.github.io/gemini-cli/</documentacao_oficial>
        <formato>XML estruturado para LLMs</formato>
        <idioma>pt-BR</idioma>
        <tags>gemini, cli, google, ai, repl, terminal, macos, apple-silicon, ubuntu, linux, setup, instala√ß√£o</tags>
    </metadados>

    <!-- ========================================================================
         SE√á√ÉO 1: VIS√ÉO GERAL DO GEMINI CLI
         ======================================================================== -->
    
    <visao_geral>
        <descricao>
            Gemini CLI √© uma ferramenta de linha de comando que permite interagir 
            com modelos Gemini atrav√©s de uma interface REPL (Read-Eval-Print Loop) 
            interativa. A ferramenta consiste em uma aplica√ß√£o cliente (packages/cli) 
            que se comunica com um servidor local (packages/core), que por sua vez 
            gerencia requisi√ß√µes para a API Gemini e seus modelos de IA.
        </descricao>

        <componentes>
            <componente id="COMP_CLI" nome="CLI Client">
                <descricao>Aplica√ß√£o cliente que fornece a interface REPL</descricao>
                <localizacao>packages/cli</localizacao>
            </componente>

            <componente id="COMP_CORE" nome="Core Server">
                <descricao>Servidor local que gerencia requisi√ß√µes √† API Gemini</descricao>
                <localizacao>packages/core</localizacao>
            </componente>

            <componente id="COMP_TOOLS" nome="Tools">
                <descricao>Conjunto de ferramentas para opera√ß√µes de sistema de arquivos, shell, web fetching, etc.</descricao>
                <localizacao>packages/core (gerenciado)</localizacao>
            </componente>
        </componentes>

        <recursos_principais>
            <recurso>Interface REPL interativa</recurso>
            <recurso>Integra√ß√£o com modelos Gemini</recurso>
            <recurso>Ferramentas de sistema de arquivos (read_file, write_file, read_many_files)</recurso>
            <recurso>Shell tool (run_shell_command)</recurso>
            <recurso>Web fetch e web search</recurso>
            <recurso>Memory tool (save_memory)</recurso>
            <recurso>Todo tool (write_todos)</recurso>
            <recurso>Suporte a MCP servers</recurso>
            <recurso>Extensions para funcionalidades customizadas</recurso>
            <recurso>IDE integration</recurso>
            <recurso>Checkpointing para recupera√ß√£o de estado</recurso>
            <recurso>Token caching e otimiza√ß√£o</recurso>
            <recurso>Trusted Folders para seguran√ßa</recurso>
            <recurso>Policy Engine para controle de execu√ß√£o de ferramentas</recurso>
        </recursos_principais>
    </visao_geral>

    <!-- ========================================================================
         SE√á√ÉO 2: macOS SILICON (Apple Silicon M1/M2/M3/M4)
         ======================================================================== -->
    
    <sistema nome="macos_silicon" tipo="desktop" arquitetura="arm64">
        <identificacao>
            <nome_completo>macOS com Apple Silicon (M1/M2/M3/M4)</nome_completo>
            <arquitetura_cpu>arm64 (aarch64)</arquitetura_cpu>
            <shell_padrao>zsh</shell_padrao>
            <gerenciador_pacotes>Homebrew, npm, pnpm</gerenciador_pacotes>
        </identificacao>

        <requisitos_sistema>
            <requisito id="REQ_GEMINI_MACOS_01" nivel="CRITICO">
                <tipo>Sistema Operacional</tipo>
                <valor_minimo>macOS 11.0 (Big Sur)</valor_minimo>
                <valor_recomendado>macOS 14.0+ (Sonoma) ou superior</valor_recomendado>
                <comando_verificacao>sw_vers -productVersion</comando_verificacao>
                <saida_esperada>Vers√£o no formato: MAJOR.MINOR.PATCH (ex: 14.2.1)</saida_esperada>
            </requisito>

            <requisito id="REQ_GEMINI_MACOS_02" nivel="CRITICO">
                <tipo>Arquitetura do Processador</tipo>
                <valor_exato>Apple Silicon (arm64)</valor_exato>
                <chips_suportados>M1, M1 Pro, M1 Max, M1 Ultra, M2, M2 Pro, M2 Max, M2 Ultra, M3, M3 Pro, M3 Max, M4</chips_suportados>
                <comando_verificacao>uname -m</comando_verificacao>
                <saida_esperada>arm64</saida_esperada>
            </requisito>

            <requisito id="REQ_GEMINI_MACOS_03" nivel="CRITICO">
                <tipo>Node.js</tipo>
                <valor_minimo>Node.js 18.x ou superior</valor_minimo>
                <valor_recomendado>Node.js 20.x LTS ou superior</valor_recomendado>
                <comando_verificacao>node --version</comando_verificacao>
                <saida_esperada>v20.x.x ou superior</saida_esperada>
            </requisito>

            <requisito id="REQ_GEMINI_MACOS_04" nivel="CRITICO">
                <tipo>Gerenciador de Pacotes</tipo>
                <valor_recomendado>npm ou pnpm</valor_recomendado>
                <comando_verificacao>npm --version</comando_verificacao>
                <comando_alternativo>pnpm --version</comando_alternativo>
            </requisito>

            <requisito id="REQ_GEMINI_MACOS_05" nivel="CRITICO">
                <tipo>Google Cloud API Key</tipo>
                <valor_requerido>API Key do Google AI Studio ou Google Cloud</valor_requerido>
                <obtencao>https://aistudio.google.com/app/apikey ou https://console.cloud.google.com/apis/credentials</obtencao>
            </requisito>

            <requisito id="REQ_GEMINI_MACOS_06" nivel="ALTO">
                <tipo>Mem√≥ria RAM</tipo>
                <valor_minimo>8 GB</valor_minimo>
                <valor_recomendado>16 GB ou superior</valor_recomendado>
            </requisito>
        </requisitos_sistema>

        <instalacao>
            <metodo id="INST_MACOS_NPM" nome="Instala√ß√£o via NPM (Recomendado)" ordem="1">
                <descricao>Instala√ß√£o global do Gemini CLI via npm</descricao>
                <comando>
                    <script>
#!/bin/bash
set -euo pipefail

# Verificar Node.js
if ! command -v node &> /dev/null; then
    echo "‚ùå Node.js n√£o encontrado. Instalando via Homebrew..."
    brew install node
fi

# Verificar vers√£o do Node.js
NODE_VERSION=$(node --version | cut -d'v' -f2 | cut -d'.' -f1)
if [[ "$NODE_VERSION" -lt 18 ]]; then
    echo "‚ùå Node.js 18+ necess√°rio. Vers√£o atual: $(node --version)"
    exit 1
fi

# Instalar Gemini CLI globalmente
echo "üì¶ Instalando Gemini CLI via npm..."
npm install -g @google/gemini-cli

# Verificar instala√ß√£o
gemini --version
                    </script>
                </comando>
                <validacao>gemini --version deve retornar vers√£o do CLI</validacao>
            </metodo>

            <metodo id="INST_MACOS_PNPM" nome="Instala√ß√£o via PNPM" ordem="2">
                <descricao>Instala√ß√£o via pnpm (alternativa)</descricao>
                <comando>
                    <script>
#!/bin/bash
set -euo pipefail

# Instalar pnpm se n√£o existir
if ! command -v pnpm &> /dev/null; then
    echo "üì¶ Instalando pnpm..."
    npm install -g pnpm
fi

# Instalar Gemini CLI
pnpm add -g @google/gemini-cli

# Verificar instala√ß√£o
gemini --version
                    </script>
                </comando>
                <validacao>gemini --version deve retornar vers√£o do CLI</validacao>
            </metodo>

            <metodo id="INST_MACOS_SOURCE" nome="Instala√ß√£o a partir do C√≥digo Fonte" ordem="3">
                <descricao>Clone e build do reposit√≥rio oficial</descricao>
                <comando>
                    <script>
#!/bin/bash
set -euo pipefail

# Criar diret√≥rio de desenvolvimento
mkdir -p ~/Developer
cd ~/Developer

# Clonar reposit√≥rio
if [[ ! -d "gemini-cli" ]]; then
    git clone https://github.com/google-gemini/gemini-cli.git
    cd gemini-cli
else
    cd gemini-cli
    git pull origin main
fi

# Instalar depend√™ncias
npm install

# Build do projeto
npm run build

# Link global (opcional)
npm link

# Verificar instala√ß√£o
gemini --version
                    </script>
                </comando>
                <validacao>gemini --version deve retornar vers√£o do CLI</validacao>
                <nota>M√©todo recomendado para desenvolvimento ou uso da vers√£o mais recente</nota>
            </metodo>
        </instalacao>

        <autenticacao>
            <metodo id="AUTH_MACOS_01" nome="Autentica√ß√£o com API Key" ordem="1">
                <descricao>Configurar API Key do Google AI Studio</descricao>
                <passos>
                    <passo ordem="1">
                        <acao>Obter API Key</acao>
                        <detalhes>
                            <url>https://aistudio.google.com/app/apikey</url>
                            <instrucoes>
                                1. Acesse o Google AI Studio
                                2. Clique em "Get API Key"
                                3. Crie ou selecione um projeto
                                4. Copie a API Key gerada
                            </instrucoes>
                        </detalhes>
                    </passo>

                    <passo ordem="2">
                        <acao>Configurar API Key</acao>
                        <comando>
                            <script>
#!/bin/bash
set -euo pipefail

# M√©todo 1: Vari√°vel de ambiente (recomendado)
echo "üîë Configurando API Key via vari√°vel de ambiente..."
read -sp "Cole sua API Key do Google AI Studio: " API_KEY
echo

# Adicionar ao ~/.zshrc
if ! grep -q "GEMINI_API_KEY" ~/.zshrc; then
    echo "export GEMINI_API_KEY=\"$API_KEY\"" >> ~/.zshrc
    echo "‚úÖ API Key adicionada ao ~/.zshrc"
else
    echo "‚ö†Ô∏è  GEMINI_API_KEY j√° existe em ~/.zshrc"
fi

# Exportar para sess√£o atual
export GEMINI_API_KEY="$API_KEY"

# Verificar configura√ß√£o
echo "‚úÖ API Key configurada. Execute 'source ~/.zshrc' para aplicar."
                            </script>
                        </comando>
                    </passo>

                    <passo ordem="3">
                        <acao>Verificar autentica√ß√£o</acao>
                        <comando>gemini auth verify</comando>
                        <saida_esperada>Mensagem de sucesso confirmando autentica√ß√£o</saida_esperada>
                    </passo>
                </passos>
            </metodo>

            <metodo id="AUTH_MACOS_02" nome="Autentica√ß√£o com Google Cloud" ordem="2">
                <descricao>Usar credenciais do Google Cloud Platform</descricao>
                <comando>
                    <script>
#!/bin/bash
set -euo pipefail

# Instalar Google Cloud SDK se n√£o existir
if ! command -v gcloud &> /dev/null; then
    echo "üì¶ Instalando Google Cloud SDK..."
    brew install --cask google-cloud-sdk
fi

# Autenticar
gcloud auth login

# Configurar Application Default Credentials
gcloud auth application-default login

# Verificar
gcloud auth list
                    </script>
                </comando>
                <nota>Use este m√©todo se j√° tiver conta Google Cloud configurada</nota>
            </metodo>
        </autenticacao>

        <configuracao>
            <arquivo id="CONFIG_MACOS_01" nome="Configura√ß√£o Global" localizacao="~/.gemini/config.json">
                <descricao>Arquivo de configura√ß√£o global do Gemini CLI</descricao>
                <conteudo>
{
  "apiKey": "${GEMINI_API_KEY}",
  "defaultModel": "gemini-2.0-flash-exp",
  "theme": "default",
  "trustedFolders": [
    "~/Developer",
    "~/Documents"
  ],
  "extensions": [],
  "telemetry": true,
  "tokenCaching": true
}
                </conteudo>
                <comando_criacao>
                    <script>
#!/bin/bash
set -euo pipefail

# Criar diret√≥rio de configura√ß√£o
mkdir -p ~/.gemini

# Criar arquivo de configura√ß√£o
cat > ~/.gemini/config.json << 'EOF'
{
  "apiKey": "${GEMINI_API_KEY}",
  "defaultModel": "gemini-2.0-flash-exp",
  "theme": "default",
  "trustedFolders": [
    "~/Developer",
    "~/Documents"
  ],
  "extensions": [],
  "telemetry": true,
  "tokenCaching": true
}
EOF

# Substituir vari√°vel de ambiente se existir
if [[ -n "${GEMINI_API_KEY:-}" ]]; then
    sed -i '' "s/\${GEMINI_API_KEY}/$GEMINI_API_KEY/g" ~/.gemini/config.json
fi

echo "‚úÖ Configura√ß√£o criada em ~/.gemini/config.json"
                    </script>
                </comando_criacao>
            </arquivo>

            <variavel_ambiente id="ENV_MACOS_01" nome="GEMINI_API_KEY">
                <descricao>API Key do Google AI Studio</descricao>
                <valor>API Key obtida em https://aistudio.google.com/app/apikey</valor>
                <arquivo>~/.zshrc</arquivo>
                <comando>export GEMINI_API_KEY="sua-api-key-aqui"</comando>
            </variavel_ambiente>

            <variavel_ambiente id="ENV_MACOS_02" nome="GEMINI_MODEL">
                <descricao>Modelo padr√£o do Gemini</descricao>
                <valor_padrao>gemini-2.0-flash-exp</valor_padrao>
                <valores_alternativos>
                    <valor>gemini-1.5-pro</valor>
                    <valor>gemini-1.5-flash</valor>
                    <valor>gemini-2.0-flash-exp</valor>
                </valores_alternativos>
            </variavel_ambiente>
        </configuracao>

        <uso_basico>
            <comando id="USE_MACOS_01" nome="Iniciar REPL">
                <descricao>Iniciar interface REPL interativa</descricao>
                <comando>gemini</comando>
                <comando_variante>gemini repl</comando_variante>
                <saida_esperada>Interface REPL interativa com prompt do Gemini</saida_esperada>
            </comando>

            <comando id="USE_MACOS_02" nome="Executar comando √∫nico">
                <descricao>Executar comando √∫nico sem entrar no REPL</descricao>
                <comando>gemini "explicar o que √© Python"</comando>
                <saida_esperada>Resposta do modelo Gemini</saida_esperada>
            </comando>

            <comando id="USE_MACOS_03" nome="Verificar vers√£o">
                <descricao>Verificar vers√£o instalada</descricao>
                <comando>gemini --version</comando>
                <comando_alternativo>gemini -v</comando_alternativo>
            </comando>

            <comando id="USE_MACOS_04" nome="Ajuda">
                <descricao>Mostrar ajuda e comandos dispon√≠veis</descricao>
                <comando>gemini --help</comando>
                <comando_alternativo>gemini help</comando_alternativo>
            </comando>
        </uso_basico>

        <troubleshooting>
            <problema id="PROB_GEMINI_MACOS_01">
                <sintoma>Erro: "command not found: gemini"</sintoma>
                <causa_possivel>Gemini CLI n√£o est√° instalado ou n√£o est√° no PATH</causa_possivel>
                <solucao>
                    <passo ordem="1">Verificar instala√ß√£o: npm list -g @google/gemini-cli</passo>
                    <passo ordem="2">Reinstalar: npm install -g @google/gemini-cli</passo>
                    <passo ordem="3">Verificar PATH: echo $PATH | grep node</passo>
                    <passo ordem="4">Adicionar ao PATH se necess√°rio: export PATH="/opt/homebrew/bin:$PATH"</passo>
                </solucao>
            </problema>

            <problema id="PROB_GEMINI_MACOS_02">
                <sintoma>Erro: "API key not found"</sintoma>
                <causa_possivel>API Key n√£o configurada ou vari√°vel de ambiente n√£o carregada</causa_possivel>
                <solucao>
                    <passo ordem="1">Verificar vari√°vel: echo $GEMINI_API_KEY</passo>
                    <passo ordem="2">Carregar configura√ß√£o: source ~/.zshrc</passo>
                    <passo ordem="3">Configurar manualmente: export GEMINI_API_KEY="sua-key"</passo>
                    <passo ordem="4">Verificar arquivo de config: cat ~/.gemini/config.json</passo>
                </solucao>
            </problema>

            <problema id="PROB_GEMINI_MACOS_03">
                <sintoma>Erro: "Permission denied" ao executar</sintoma>
                <causa_possivel>Problemas de permiss√£o com npm global ou Node.js</causa_possivel>
                <solucao>
                    <passo ordem="1">Verificar permiss√µes: ls -la $(npm config get prefix)</passo>
                    <passo ordem="2">Corrigir permiss√µes: sudo chown -R $(whoami) $(npm config get prefix)/{lib/node_modules,bin,share}</passo>
                    <passo ordem="3">Ou usar nvm para gerenciar Node.js</passo>
                </solucao>
            </problema>
        </troubleshooting>
    </sistema>

    <!-- ========================================================================
         SE√á√ÉO 3: UBUNTU (Linux)
         ======================================================================== -->
    
    <sistema nome="ubuntu" tipo="servidor" arquitetura="x86_64">
        <identificacao>
            <nome_completo>Ubuntu Linux (LTS)</nome_completo>
            <arquitetura_cpu>x86_64 (amd64)</arquitetura_cpu>
            <shell_padrao>bash</shell_padrao>
            <gerenciador_pacotes>apt, npm, pnpm</gerenciador_pacotes>
            <init_system>systemd</init_system>
        </identificacao>

        <versoes_suportadas>
            <versao id="UBUNTU_22_04">
                <codigo>22.04 LTS</codigo>
                <nome>Jammy Jellyfish</nome>
                <status>Recomendado</status>
            </versao>

            <versao id="UBUNTU_24_04">
                <codigo>24.04 LTS</codigo>
                <nome>Noble Numbat</nome>
                <status>Mais recente</status>
            </versao>
        </versoes_suportadas>

        <requisitos_sistema>
            <requisito id="REQ_GEMINI_UBUNTU_01" nivel="CRITICO">
                <tipo>Sistema Operacional</tipo>
                <valor_minimo>Ubuntu 20.04 LTS</valor_minimo>
                <valor_recomendado>Ubuntu 22.04 LTS ou 24.04 LTS</valor_recomendado>
                <comando_verificacao>lsb_release -a</comando_verificacao>
            </requisito>

            <requisito id="REQ_GEMINI_UBUNTU_02" nivel="CRITICO">
                <tipo>Node.js</tipo>
                <valor_minimo>Node.js 18.x ou superior</valor_minimo>
                <valor_recomendado>Node.js 20.x LTS</valor_recomendado>
                <comando_verificacao>node --version</comando_verificacao>
            </requisito>

            <requisito id="REQ_GEMINI_UBUNTU_03" nivel="CRITICO">
                <tipo>Google Cloud API Key</tipo>
                <valor_requerido>API Key do Google AI Studio</valor_requerido>
            </requisito>

            <requisito id="REQ_GEMINI_UBUNTU_04" nivel="ALTO">
                <tipo>Mem√≥ria RAM</tipo>
                <valor_minimo>2 GB</valor_minimo>
                <valor_recomendado>4 GB ou superior</valor_recomendado>
            </requisito>

            <requisito id="REQ_GEMINI_UBUNTU_05" nivel="CRITICO">
                <tipo>Acesso Root/Sudo</tipo>
                <valor_requerido>Usu√°rio com privil√©gios sudo</valor_requerido>
            </requisito>
        </requisitos_sistema>

        <instalacao>
            <etapa id="INST_UBUNTU_01" ordem="1">
                <nome>Instala√ß√£o do Node.js via NodeSource</nome>
                <comando>
                    <script>
#!/bin/bash
set -euo pipefail

# Verificar se Node.js j√° est√° instalado
if command -v node &> /dev/null; then
    NODE_VERSION=$(node --version | cut -d'v' -f2 | cut -d'.' -f1)
    if [[ "$NODE_VERSION" -ge 18 ]]; then
        echo "‚úÖ Node.js j√° instalado: $(node --version)"
        exit 0
    fi
fi

# Instalar Node.js 20.x LTS via NodeSource
echo "üì¶ Instalando Node.js 20.x LTS..."
curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -
sudo apt-get install -y nodejs

# Verificar instala√ß√£o
node --version
npm --version
                    </script>
                </comando>
                <validacao>node --version deve retornar v20.x.x ou superior</validacao>
            </etapa>

            <etapa id="INST_UBUNTU_02" ordem="2">
                <nome>Instala√ß√£o do Gemini CLI via NPM</nome>
                <comando>
                    <script>
#!/bin/bash
set -euo pipefail

# Instalar Gemini CLI globalmente
echo "üì¶ Instalando Gemini CLI via npm..."
sudo npm install -g @google/gemini-cli

# Verificar instala√ß√£o
gemini --version

# Verificar localiza√ß√£o
which gemini
                    </script>
                </comando>
                <validacao>gemini --version deve retornar vers√£o do CLI</validacao>
            </etapa>

            <etapa id="INST_UBUNTU_03" ordem="3">
                <nome>Instala√ß√£o via PNPM (Alternativa)</nome>
                <comando>
                    <script>
#!/bin/bash
set -euo pipefail

# Instalar pnpm globalmente
echo "üì¶ Instalando pnpm..."
sudo npm install -g pnpm

# Instalar Gemini CLI via pnpm
sudo pnpm add -g @google/gemini-cli

# Verificar
gemini --version
                    </script>
                </comando>
                <nota>M√©todo alternativo caso prefira usar pnpm</nota>
            </etapa>

            <etapa id="INST_UBUNTU_04" ordem="4">
                <nome>Instala√ß√£o a partir do C√≥digo Fonte</nome>
                <comando>
                    <script>
#!/bin/bash
set -euo pipefail

# Criar diret√≥rio de desenvolvimento
mkdir -p ~/Developer
cd ~/Developer

# Clonar reposit√≥rio
if [[ ! -d "gemini-cli" ]]; then
    git clone https://github.com/google-gemini/gemini-cli.git
    cd gemini-cli
else
    cd gemini-cli
    git pull origin main
fi

# Instalar depend√™ncias
npm install

# Build do projeto
npm run build

# Link global (requer sudo ou configura√ß√£o de permiss√µes)
sudo npm link

# Verificar
gemini --version
                    </script>
                </comando>
                <nota>Recomendado para desenvolvimento ou vers√£o mais recente</nota>
            </etapa>
        </instalacao>

        <autenticacao>
            <metodo id="AUTH_UBUNTU_01" nome="Autentica√ß√£o com API Key" ordem="1">
                <descricao>Configurar API Key do Google AI Studio</descricao>
                <comando>
                    <script>
#!/bin/bash
set -euo pipefail

# Solicitar API Key
echo "üîë Configurando API Key do Google AI Studio..."
read -sp "Cole sua API Key: " API_KEY
echo

# Adicionar ao ~/.bashrc
if ! grep -q "GEMINI_API_KEY" ~/.bashrc; then
    echo "export GEMINI_API_KEY=\"$API_KEY\"" >> ~/.bashrc
    echo "‚úÖ API Key adicionada ao ~/.bashrc"
else
    echo "‚ö†Ô∏è  GEMINI_API_KEY j√° existe em ~/.bashrc"
fi

# Exportar para sess√£o atual
export GEMINI_API_KEY="$API_KEY"

# Carregar configura√ß√£o
source ~/.bashrc

echo "‚úÖ API Key configurada"
                    </script>
                </comando>
            </metodo>

            <metodo id="AUTH_UBUNTU_02" nome="Autentica√ß√£o com Google Cloud (Headless)" ordem="2">
                <descricao>Usar Service Account para autentica√ß√£o sem intera√ß√£o</descricao>
                <comando>
                    <script>
#!/bin/bash
set -euo pipefail

# Instalar Google Cloud SDK
if ! command -v gcloud &> /dev/null; then
    echo "üì¶ Instalando Google Cloud SDK..."
    curl https://sdk.cloud.google.com | bash
    exec -l $SHELL
    gcloud init
fi

# Autenticar com Service Account
read -p "Caminho para arquivo de Service Account JSON: " SA_FILE

if [[ -f "$SA_FILE" ]]; then
    gcloud auth activate-service-account --key-file="$SA_FILE"
    gcloud auth application-default login --no-launch-browser
    echo "‚úÖ Autentica√ß√£o configurada"
else
    echo "‚ùå Arquivo n√£o encontrado: $SA_FILE"
    exit 1
fi
                    </script>
                </comando>
                <nota>Recomendado para ambientes VPS/headless</nota>
            </metodo>
        </autenticacao>

        <configuracao>
            <arquivo id="CONFIG_UBUNTU_01" nome="Configura√ß√£o Global" localizacao="~/.gemini/config.json">
                <descricao>Arquivo de configura√ß√£o global</descricao>
                <comando_criacao>
                    <script>
#!/bin/bash
set -euo pipefail

# Criar diret√≥rio de configura√ß√£o
mkdir -p ~/.gemini

# Criar arquivo de configura√ß√£o
cat > ~/.gemini/config.json << 'EOF'
{
  "apiKey": "${GEMINI_API_KEY}",
  "defaultModel": "gemini-2.0-flash-exp",
  "theme": "default",
  "trustedFolders": [
    "~/Developer",
    "~/Documents"
  ],
  "extensions": [],
  "telemetry": true,
  "tokenCaching": true
}
EOF

# Substituir vari√°vel de ambiente se existir
if [[ -n "${GEMINI_API_KEY:-}" ]]; then
    sed -i "s/\${GEMINI_API_KEY}/$GEMINI_API_KEY/g" ~/.gemini/config.json
fi

echo "‚úÖ Configura√ß√£o criada em ~/.gemini/config.json"
                    </script>
                </comando_criacao>
            </arquivo>

            <variavel_ambiente id="ENV_UBUNTU_01" nome="GEMINI_API_KEY">
                <descricao>API Key do Google AI Studio</descricao>
                <arquivo>~/.bashrc</arquivo>
                <comando>export GEMINI_API_KEY="sua-api-key-aqui"</comando>
            </variavel_ambiente>
        </configuracao>

        <servico_systemd>
            <arquivo id="SYSTEMD_01" nome="Servi√ßo Gemini CLI (Opcional)" localizacao="/etc/systemd/system/gemini-cli.service">
                <descricao>Servi√ßo systemd para executar Gemini CLI como daemon</descricao>
                <conteudo>
[Unit]
Description=Gemini CLI Service
After=network.target

[Service]
Type=simple
User=seu-usuario
Environment="GEMINI_API_KEY=SUA_API_KEY_AQUI"
ExecStart=/usr/bin/gemini repl
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
                </conteudo>
                <comando_criacao>
                    <script>
#!/bin/bash
set -euo pipefail

# Criar arquivo de servi√ßo
sudo tee /etc/systemd/system/gemini-cli.service > /dev/null <<EOF
[Unit]
Description=Gemini CLI Service
After=network.target

[Service]
Type=simple
User=$USER
Environment="GEMINI_API_KEY=${GEMINI_API_KEY}"
ExecStart=$(which gemini) repl
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
EOF

# Recarregar systemd
sudo systemctl daemon-reload

# Habilitar servi√ßo (opcional)
# sudo systemctl enable gemini-cli.service
# sudo systemctl start gemini-cli.service

echo "‚úÖ Servi√ßo systemd criado (n√£o habilitado por padr√£o)"
                    </script>
                </comando_criacao>
                <nota>Servi√ßo opcional para execu√ß√£o em background</nota>
            </arquivo>
        </servico_systemd>

        <uso_basico>
            <comando id="USE_UBUNTU_01" nome="Iniciar REPL">
                <descricao>Iniciar interface REPL interativa</descricao>
                <comando>gemini</comando>
            </comando>

            <comando id="USE_UBUNTU_02" nome="Executar comando √∫nico">
                <descricao>Executar comando √∫nico</descricao>
                <comando>gemini "explicar o que √© Docker"</comando>
            </comando>
        </uso_basico>

        <troubleshooting>
            <problema id="PROB_GEMINI_UBUNTU_01">
                <sintoma>Erro: "EACCES: permission denied" ao instalar globalmente</sintoma>
                <causa_possivel>Problemas de permiss√£o com npm global</causa_possivel>
                <solucao>
                    <passo ordem="1">Configurar prefix do npm: npm config set prefix ~/.local</passo>
                    <passo ordem="2">Adicionar ao PATH: echo 'export PATH="$HOME/.local/bin:$PATH"' >> ~/.bashrc</passo>
                    <passo ordem="3">Instalar sem sudo: npm install -g @google/gemini-cli</passo>
                    <passo ordem="4">Ou usar sudo: sudo npm install -g @google/gemini-cli</passo>
                </solucao>
            </problema>

            <problema id="PROB_GEMINI_UBUNTU_02">
                <sintoma>Node.js vers√£o antiga</sintoma>
                <causa_possivel>Reposit√≥rio padr√£o do Ubuntu tem Node.js antigo</causa_possivel>
                <solucao>
                    <passo ordem="1">Remover Node.js antigo: sudo apt remove nodejs npm</passo>
                    <passo ordem="2">Instalar NodeSource: curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -</passo>
                    <passo ordem="3">Instalar Node.js: sudo apt-get install -y nodejs</passo>
                </solucao>
            </problema>
        </troubleshooting>
    </sistema>

    <!-- ========================================================================
         SE√á√ÉO 4: FERRAMENTAS E RECURSOS
         ======================================================================== -->
    
    <ferramentas>
        <ferramenta id="TOOL_01" nome="read_file">
            <descricao>Ler conte√∫do de arquivo</descricao>
            <uso>Dispon√≠vel automaticamente no REPL</uso>
            <exemplo>No REPL: "leia o arquivo README.md"</exemplo>
        </ferramenta>

        <ferramenta id="TOOL_02" nome="write_file">
            <descricao>Escrever conte√∫do em arquivo</descricao>
            <uso>Dispon√≠vel automaticamente no REPL</uso>
            <exemplo>No REPL: "crie um arquivo teste.txt com o conte√∫do 'Hello World'"</exemplo>
        </ferramenta>

        <ferramenta id="TOOL_03" nome="read_many_files">
            <descricao>Ler m√∫ltiplos arquivos de uma vez</descricao>
            <uso>√ötil para an√°lise de c√≥digo em m√∫ltiplos arquivos</uso>
        </ferramenta>

        <ferramenta id="TOOL_04" nome="run_shell_command">
            <descricao>Executar comandos shell</descricao>
            <uso>Permite executar comandos do sistema dentro do REPL</uso>
            <exemplo>No REPL: "execute ls -la na pasta atual"</exemplo>
        </ferramenta>

        <ferramenta id="TOOL_05" nome="web_fetch">
            <descricao>Buscar conte√∫do de URLs</descricao>
            <uso>Fazer requisi√ß√µes HTTP dentro do REPL</uso>
        </ferramenta>

        <ferramenta id="TOOL_06" nome="google_web_search">
            <descricao>Busca na web via Google</descricao>
            <uso>Realizar buscas na internet</uso>
        </ferramenta>

        <ferramenta id="TOOL_07" nome="save_memory">
            <descricao>Salvar mem√≥rias para contexto persistente</descricao>
            <uso>Armazenar informa√ß√µes para uso futuro</uso>
        </ferramenta>

        <ferramenta id="TOOL_08" nome="write_todos">
            <descricao>Criar lista de tarefas</descricao>
            <uso>Gerenciar tarefas dentro do REPL</uso>
        </ferramenta>
    </ferramentas>

    <!-- ========================================================================
         SE√á√ÉO 5: CHECKLIST DE VALIDA√á√ÉO
         ======================================================================== -->
    
    <checklist_validacao>
        <checklist nome="macos_silicon">
            <item id="CHECK_GEMINI_MACOS_01">
                <descricao>Node.js 18+ instalado</descricao>
                <comando>node --version</comando>
            </item>

            <item id="CHECK_GEMINI_MACOS_02">
                <descricao>npm ou pnpm instalado</descricao>
                <comando>npm --version || pnpm --version</comando>
            </item>

            <item id="CHECK_GEMINI_MACOS_03">
                <descricao>Gemini CLI instalado</descricao>
                <comando>gemini --version</comando>
            </item>

            <item id="CHECK_GEMINI_MACOS_04">
                <descricao>API Key configurada</descricao>
                <comando>echo $GEMINI_API_KEY</comando>
            </item>

            <item id="CHECK_GEMINI_MACOS_05">
                <descricao>REPL funciona</descricao>
                <comando>gemini "teste"</comando>
            </item>
        </checklist>

        <checklist nome="ubuntu">
            <item id="CHECK_GEMINI_UBUNTU_01">
                <descricao>Node.js 18+ instalado</descricao>
                <comando>node --version</comando>
            </item>

            <item id="CHECK_GEMINI_UBUNTU_02">
                <descricao>npm instalado</descricao>
                <comando>npm --version</comando>
            </item>

            <item id="CHECK_GEMINI_UBUNTU_03">
                <descricao>Gemini CLI instalado</descricao>
                <comando>gemini --version</comando>
            </item>

            <item id="CHECK_GEMINI_UBUNTU_04">
                <descricao>API Key configurada</descricao>
                <comando>echo $GEMINI_API_KEY</comando>
            </item>

            <item id="CHECK_GEMINI_UBUNTU_05">
                <descricao>REPL funciona</descricao>
                <comando>gemini "teste"</comando>
            </item>
        </checklist>
    </checklist_validacao>

    <!-- ========================================================================
         SE√á√ÉO 6: METADADOS PARA LLMS
         ======================================================================== -->
    
    <metadados_llm>
        <formato_estruturado>XML hier√°rquico com tags sem√¢nticas</formato_estruturado>
        <otimizacoes>
            <otimizacao>IDs √∫nicos para todos os elementos</otimizacao>
            <otimizacao>Hierarquia clara com n√≠veis consistentes</otimizacao>
            <otimizacao>Comandos execut√°veis completos</otimizacao>
            <otimizacao>Sa√≠das esperadas documentadas</otimizacao>
            <otimizacao>Separa√ß√£o clara entre macOS e Ubuntu</otimizacao>
            <otimizacao>Troubleshooting estruturado</otimizacao>
            <otimizacao>M√∫ltiplos m√©todos de instala√ß√£o documentados</otimizacao>
        </otimizacoes>

        <instrucoes_interpretacao>
            <instrucao>
                <tipo>Parsing</tipo>
                <descricao>Use IDs √∫nicos (ex: REQ_GEMINI_MACOS_01, INST_UBUNTU_02) para referenciar elementos</descricao>
            </instrucao>

            <instrucao>
                <tipo>Comandos</tipo>
                <descricao>Todos os comandos em tags &lt;script&gt; ou &lt;comando&gt; s√£o execut√°veis</descricao>
            </instrucao>

            <instrucao>
                <tipo>Valida√ß√£o</tipo>
                <descricao>Use &lt;saida_esperada&gt; e &lt;validacao&gt; para verificar execu√ß√£o</descricao>
            </instrucao>

            <instrucao>
                <tipo>Ordem</tipo>
                <descricao>Respeite atributo 'ordem' nas etapas de instala√ß√£o</descricao>
            </instrucao>
        </instrucoes_interpretacao>

        <referencias_externas>
            <referencia>
                <tipo>Reposit√≥rio GitHub</tipo>
                <url>https://github.com/google-gemini/gemini-cli</url>
            </referencia>

            <referencia>
                <tipo>Documenta√ß√£o Oficial</tipo>
                <url>https://google-gemini.github.io/gemini-cli/</url>
            </referencia>

            <referencia>
                <tipo>Google AI Studio</tipo>
                <url>https://aistudio.google.com/app/apikey</url>
            </referencia>

            <referencia>
                <tipo>Google Cloud Console</tipo>
                <url>https://console.cloud.google.com/apis/credentials</url>
            </referencia>
        </referencias_externas>
    </metadados_llm>
</instrucoes_gemini_cli>

