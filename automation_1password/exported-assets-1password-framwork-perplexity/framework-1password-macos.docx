# Framework Customizado de Prompts Otimizados para 1Password no macOS Silicon

## 1. INTRODUÇÃO
Este framework entrega um conjunto de prompts otimizados para automação e gerenciamento seguro de secrets com 1Password CLI v2 em ambiente macOS Silicon. Destinado a DevOps, engenheiros de segurança e arquitetos de software que buscam otimizar tempo, elevar segurança e padronizar a interação entre scripts, CI/CD e vaults corporativos.

**Benefícios:**
- Agilidade e segurança no provisionamento de secrets
- Integração avançada com CI/CD via Service Accounts
- Eliminação de exposição de credenciais em scripts ou repositórios

## 2. FRAMEWORK PRINCIPAL (5 Prompts Mestres)

### PROMPT 1: Automação Completa do 1Password CLI
**Objetivo:** Setup inicial, configuração avançada e integração com scripts locais no macOS Silicon.
**Contexto Técnico:** Homebrew, CLI v2, Touch ID, Service Account, arquivo .op/config
**Estrutura:** Passo-a-passo com checkpoints de validação
**Variáveis Dinâmicas:** {{service_account_token}}, {{vault_name}}, {{item_name}}, {{config_path}}
**Exemplos de Uso:**
```shell
brew install --cask 1password-cli
op --version
export OP_SERVICE_ACCOUNT_TOKEN='ops_xxx...'
op vault list
op item get {{item_name}} --vault={{vault_name}} --fields label=password
```
**Validação:**
- op --version
- op signin
- op whoami
- op vault list
**Dicas de Otimização:**
- Usar autenticação biométrica (Touch ID)
- Validar integração desktop antes do uso em scripts

### PROMPT 2: Integração com CI/CD (GitHub Actions)
**Objetivo:** Automação segura de secrets em pipelines, conforme best practices
**Contexto:** load-secrets-action@v3, OP_SERVICE_ACCOUNT_TOKEN via Secrets, syntax op://
**Estrutura:** Template YAML-ready
**Exemplo YAML:**
```yaml
on: push
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Load secrets
        uses: 1password/load-secrets-action@v3
        env:
          OP_SERVICE_ACCOUNT_TOKEN: ${{ secrets.OP_SERVICE_ACCOUNT_TOKEN }}
          API_KEY: op://{{vault_name}}/{{item_name}}/api_key
```
**Dicas:**
- Separar vaults por ambiente
- Checar rate limits em grandes workflows

### PROMPT 3: Desenvolvimento de Agentes/Subagentes
**Objetivo:** Orquestração de workflows inteligentes usando Python ou Node.js com SDK oficial
**Contexto:** Uso do onepassword-sdk, microserviços, decisões contextuais
**Exemplo Python:**
```python
import asyncio, os
from onepassword.client import Client
async def agent():
    token = os.getenv('OP_SERVICE_ACCOUNT_TOKEN')
    client = await Client.authenticate(auth=token)
    api_key = await client.secrets.resolve('op://vault/item/field')
```
**Dicas:**
- Divida agentes por função (Rotação, Provisionamento, Auditoria)

### PROMPT 4: Debugging e Troubleshooting
**Objetivo:** Diagnóstico rápido e resolução de problemas recorrentes do CLI no macOS Silicon
**Estrutura:** Checklist decisório
**Erros comuns:**
- LostConnectionToApp
- Touch ID não habilitado
- Token expirado
**Ações:**
- Atualizar app e CLI
- Testar binário via .pkg se erro com Homebrew
- Resetar integração em Settings > Developer

### PROMPT 5: Segurança e Compliance
**Objetivo:** Hardening, auditoria e conformidade (SOC2/GDPR)
**Checklist:**
- Vaults segmentados por ambiente
- Proteção e rotação de tokens
- Uso exclusivo do op:// em todos scripts
- Auditoria regular via admin console

## 3. PROMPTS SECUNDÁRIOS (10 exemplos)
- Instalar CLI via Homebrew: `brew install --cask 1password-cli`
- Criar Service Account: Menu Integrations > Service Accounts
- Listar Vaults: `op vault list`
- Verificar autenticação: `op whoami`
- Rotacionar Token: Admin console + update em secrets do CI/CD
- Inject secrets em script: `.env` com op:// e comando `op run --env-file=.env -- node app.js`
- Adicionar secret em item: `op item edit {{item_name}} --vault={{vault_name}} token=new_value`
- Callback Touch ID: Steps Settings > Security > Touch ID
- Usar op inject: `op inject -i config.yml.tpl -o config.yml`
- Sintaxe op://: `op://Production/AWS/credentials/access_key_id`

## 4. TÉCNICAS DE OTIMIZAÇÃO DE PROMPTS
- Chain-of-Thought: decompor passo-a-passo
- Few-Shot Learning: fornecer exemplos
- Role-Based Prompting: definir persona
- Context Injection: inserir contexto técnico
- Constraint-Based Prompting: impor restrições ('sem plaintext')
- Output Format Specification: exigir JSON/YAML/código estruturado

## 5. MATRIZ DE SELEÇÃO DE MODELO DE LLM
| Tarefa                    | Prompt Recomendado         | Modelo Ideal      | 
|--------------------------|---------------------------|-------------------|
| Deploy CI/CD (GitHub)    | Integração CI/CD (YAML)   | ChatGPT, Claude   |
| Rotação de Token         | Rotacionar Token Serviço  | ChatGPT           |
| Diagnóstico CLI          | Debugging/Checklist       | Claude (CoT)      |
| Geração de Agente        | Dev Agente/Subagente      | ChatGPT, Claude   |

## 6. EXEMPLOS PRÁTICOS COMPLETOS
### Caso 1: Deploy com secrets protegidos
```yaml
on: push
jobs:
  app:
    steps:
      - name: Load secrets
        uses: 1password/load-secrets-action@v3
        env:
          OP_SERVICE_ACCOUNT_TOKEN: ${{ secrets.OP_SERVICE_ACCOUNT_TOKEN }}
          DB_PASS: op://Production/Database/password
      - run: echo $DB_PASS
```
### Caso 2: Script local seguro
```shell
export OP_SERVICE_ACCOUNT_TOKEN='ops_xxx...'
op run --env-file=.env -- ./deploy.sh
```
### Caso 3: Template dotfiles com chezmoi
```zsh
export API_TOKEN='{{ onepasswordRead "op://Personal/api-token/password" }}'
```

## 7. GUIA DE IMPLEMENTAÇÃO
1. Instalar 1Password CLI via Homebrew ou .pkg
2. Habilitar integração desktop e Touch ID
3. Configurar Service Account e tokens em .env ou GitHub Secrets
4. Validar prompts e outputs no terminal/CI
5. Automatizar scripts conforme os templates do framework

## 8. MÉTRICAS E VALIDAÇÃO DE RESPOSTAS
- Saída segue formato esperado (JSON/YAML/tabela)
- Zero exposição de segredos em plaintext
- Output resolve prompts corretamente (valide via CLI/op whoami)
- Feedback loop: ajuste de prompt por erro ou omissão

## 9. TROUBLESHOOTING DO FRAMEWORK
- Erros de autenticação: reiniciar app, checar integração
- Permissões: revisar acesso Service Account no vault
- Touch ID falha: resetar app, validar hardware
- Token expirado: rotacionar, atualizar secrets no CI/CD
- Documentar escalar para suporte oficial caso necessário

## 10. REFERÊNCIAS E RECURSOS ADICIONAIS
- [1Password CLI Docs](https://developer.1password.com/docs/cli/get-started/)
- [Service Accounts Security](https://developer.1password.com/docs/service-accounts/security/)
- [GitHub Action - Load Secrets](https://github.com/1Password/load-secrets-action)
- [Perplexity: Página principal](https://www.perplexity.ai/page/1password-macos-silicon-automa-mLWAbReFTp6.ofy7rAaFWw)
- [Dotfiles com Chezmoi](https://github.com/tim-mcdonnell/dotfiles)

*Framework pronto para produção, validado para o ecossistema Apple Silicon. Recomenda-se versionar e atualizar conforme boas práticas do 1Password CLI e macOS Silicon.*