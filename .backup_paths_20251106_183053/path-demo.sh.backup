#!/bin/bash
# path-demo.sh - DemonstraÃ§Ã£o de como trato o caminho home

set -euo pipefail

# Cores para output
GREEN='\033[0;32m'
BLUE='\033[0;34m'
YELLOW='\033[1;33m'
CYAN='\033[0;36m'
WHITE='\033[1;37m'
NC='\033[0m'

echo -e "${WHITE}ğŸ” DEMONSTRAÃ‡ÃƒO DE TRATAMENTO DO CAMINHO HOME${NC}"
echo -e "${WHITE}==============================================${NC}"
echo ""

# 1. VariÃ¡veis de ambiente padrÃ£o
echo -e "${CYAN}ğŸ“ VARIÃVEIS DE AMBIENTE PADRÃƒO:${NC}"
echo "----------------------------------------"
echo "HOME: $HOME"
echo "USER: $USER"
echo "PWD: $PWD"
echo ""

# 2. Caminhos absolutos
echo -e "${CYAN}ğŸ“‚ CAMINHOS ABSOLUTOS:${NC}"
echo "------------------------"
echo "Home do usuÃ¡rio: /Users/luiz.sena88"
echo "DiretÃ³rio atual: $(pwd)"
echo "DiretÃ³rio alvo: $DOTFILES_HOME/automacao_1password"
echo ""

# 3. VerificaÃ§Ã£o de existÃªncia
echo -e "${CYAN}ğŸ” VERIFICAÃ‡ÃƒO DE EXISTÃŠNCIA:${NC}"
echo "-----------------------------------"

TARGET_DIR="$DOTFILES_HOME/automacao_1password"

if [ -d "$TARGET_DIR" ]; then
    echo -e "${GREEN}âœ… DiretÃ³rio existe: $TARGET_DIR${NC}"
else
    echo -e "${YELLOW}âŒ DiretÃ³rio nÃ£o encontrado: $TARGET_DIR${NC}"
fi

if [ -r "$TARGET_DIR" ]; then
    echo -e "${GREEN}âœ… PermissÃ£o de leitura: OK${NC}"
else
    echo -e "${YELLOW}âŒ Sem permissÃ£o de leitura${NC}"
fi

if [ -w "$TARGET_DIR" ]; then
    echo -e "${GREEN}âœ… PermissÃ£o de escrita: OK${NC}"
else
    echo -e "${YELLOW}âŒ Sem permissÃ£o de escrita${NC}"
fi

if [ -x "$TARGET_DIR" ]; then
    echo -e "${GREEN}âœ… PermissÃ£o de execuÃ§Ã£o: OK${NC}"
else
    echo -e "${YELLOW}âŒ Sem permissÃ£o de execuÃ§Ã£o${NC}"
fi

echo ""

# 4. Estrutura de diretÃ³rios
echo -e "${CYAN}ğŸ“Š ESTRUTURA DE DIRETÃ“RIOS:${NC}"
echo "--------------------------------"
echo "ConteÃºdo do diretÃ³rio alvo:"
ls -la "$TARGET_DIR" | head -10

echo ""

# 5. EstatÃ­sticas bÃ¡sicas
echo -e "${CYAN}ğŸ“ˆ ESTATÃSTICAS BÃSICAS:${NC}"
echo "----------------------------"
TOTAL_ITEMS=$(find "$TARGET_DIR" -maxdepth 1 -not -path "$TARGET_DIR" | wc -l | tr -d ' ')
TOTAL_DIRS=$(find "$TARGET_DIR" -maxdepth 1 -type d -not -path "$TARGET_DIR" | wc -l | tr -d ' ')
TOTAL_FILES=$(find "$TARGET_DIR" -maxdepth 1 -type f | wc -l | tr -d ' ')

echo "Total de itens: $TOTAL_ITEMS"
echo "DiretÃ³rios: $TOTAL_DIRS"
echo "Arquivos: $TOTAL_FILES"

# 6. Tamanho total
TOTAL_SIZE=$(du -sk "$TARGET_DIR" 2>/dev/null | cut -f1)
if [ -n "$TOTAL_SIZE" ]; then
    if [ "$TOTAL_SIZE" -lt 1024 ]; then
        SIZE_FORMATTED="${TOTAL_SIZE}KB"
    elif [ "$TOTAL_SIZE" -lt 1048576 ]; then
        SIZE_FORMATTED="$((TOTAL_SIZE / 1024))MB"
    else
        SIZE_FORMATTED="$((TOTAL_SIZE / 1048576))GB"
    fi
    echo "Tamanho total: $SIZE_FORMATTED"
else
    echo "Tamanho total: NÃ£o disponÃ­vel"
fi

echo ""

# 7. URLs completas (como vocÃª solicitou)
echo -e "${CYAN}ğŸŒ URLs COMPLETAS:${NC}"
echo "-------------------"
echo "file://$TARGET_DIR"
echo "file://$TARGET_DIR/docs/"
echo "file://$TARGET_DIR/configs/"
echo "file://$TARGET_DIR/archives/"

echo ""

# 8. Caminhos relativos
echo -e "${CYAN}ğŸ“‚ CAMINHOS RELATIVOS:${NC}"
echo "----------------------------"
RELATIVE_PATH="${TARGET_DIR#$HOME}"
echo "Caminho relativo ao home: $RELATIVE_PATH"
echo "Caminho relativo ao PWD: $(realpath --relative-to="$(pwd)" "$TARGET_DIR" 2>/dev/null || echo "N/A")"

echo ""

# 9. DemonstraÃ§Ã£o de como os scripts tratam o caminho
echo -e "${CYAN}ğŸ”§ COMO OS SCRIPTS TRATAM O CAMINHO:${NC}"
echo "--------------------------------------------"

# Simular o tratamento do script permissions-checker.sh
echo "1. VerificaÃ§Ã£o de existÃªncia:"
if [ ! -d "$TARGET_DIR" ]; then
    echo "   âŒ DiretÃ³rio nÃ£o encontrado: $TARGET_DIR"
    exit 1
else
    echo "   âœ… DiretÃ³rio encontrado: $TARGET_DIR"
fi

echo ""
echo "2. VerificaÃ§Ã£o de permissÃµes:"
if [ ! -r "$TARGET_DIR" ]; then
    echo "   âŒ Sem permissÃ£o de leitura: $TARGET_DIR"
    exit 1
else
    echo "   âœ… PermissÃ£o de leitura: OK"
fi

echo ""
echo "3. Processamento recursivo:"
echo "   ğŸ“ Analisando: $TARGET_DIR"
echo "   ğŸ“Š Profundidade mÃ¡xima: 3"
echo "   ğŸ” Processando itens..."

# Simular processamento de alguns itens
find "$TARGET_DIR" -maxdepth 1 -not -path "$TARGET_DIR" | head -5 | while read -r item; do
    if [ -d "$item" ]; then
        echo "   ğŸ“ $(basename "$item") (diretÃ³rio)"
    else
        echo "   ğŸ“„ $(basename "$item") (arquivo)"
    fi
done

echo ""
echo -e "${GREEN}âœ… DemonstraÃ§Ã£o concluÃ­da!${NC}"
echo -e "${GREEN}   Os scripts tratam o caminho home de forma absoluta e segura${NC}"
